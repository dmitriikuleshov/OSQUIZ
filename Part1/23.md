### Планирование процессов: введение в системы реального времени

**Планирование процессов** — это механизм, с помощью которого операционная система (ОС) распределяет процессорное время между процессами. В системах реального времени (СРВ) планирование процессов приобретает особую важность, так как такие системы работают с жёсткими временными ограничениями. Главная цель — обеспечить выполнение задач строго в заданные временные рамки.

---

### Системы реального времени: определение и ключевые характеристики

**Системы реального времени** — это системы, в которых правильность выполнения задач зависит не только от корректности результата, но и от времени, за которое этот результат был получен. Такие системы широко используются в областях, где критически важна временная предсказуемость, например, в авиации, медицинских приборах, автомобильных системах, робототехнике и телекоммуникациях.

#### Классификация систем реального времени:

1. **Жёсткие системы реального времени (Hard Real-Time Systems)**:

    - Задания должны быть выполнены строго в заданное время.
    - Пример: системы управления полётом самолёта, медицинские аппараты.
    - Невыполнение задачи в срок может привести к катастрофическим последствиям.

2. **Мягкие системы реального времени (Soft Real-Time Systems)**:
    - Желательно выполнение задач в срок, но допустимы небольшие отклонения.
    - Пример: потоковое видео, онлайн-игры.
    - Невыполнение задачи влияет на качество, но не приводит к фатальным сбоям.

#### Характеристики систем реального времени:

1. **Дедлайн (Deadline)**:

    - Временной интервал, в течение которого задача должна быть выполнена.
    - Дедлайны могут быть:
        - Абсолютные (фиксированная точка во времени).
        - Относительные (время с момента запуска задачи).

2. **Периодичность (Periodicity)**:

    - Задачи могут быть:
        - Периодическими (выполняются регулярно через заданные интервалы времени).
        - Апериодическими (выполняются по запросу).

3. **Детерминизм**:

    - Система должна предсказуемо реагировать на запросы в рамках заданных временных ограничений.

4. **Приоритеты задач**:

    - Некоторые задачи имеют более высокий приоритет, чем другие, из-за их критической важности.

5. **Пропускная способность (Throughput)**:
    - Доля выполненных задач в срок от общего числа заданий.

---

### Характеристики планирования в системах реального времени

Планирование в системах реального времени отличается от планирования в универсальных ОС. Главная цель — обеспечение временной предсказуемости.

#### Основные требования к планированию в СРВ:

1. **Временная предсказуемость**:

    - ОС должна гарантировать выполнение задач в рамках их временных ограничений.
    - Все дедлайны должны быть соблюдены для жёстких задач реального времени.

2. **Поддержка приоритетов**:

    - Задачи с высоким приоритетом должны обрабатываться раньше задач с низким приоритетом.

3. **Минимизация накладных расходов**:

    - Частые переключения контекста увеличивают задержки, что неприемлемо для СРВ.

4. **Реакция на внешние события**:
    - ОС должна быстро обрабатывать события, поступающие извне.

#### Типы планирования в СРВ:

1. **Статическое планирование**:

    - Решение о порядке выполнения задач принимается заранее.
    - Пример: Rate Monotonic Scheduling (RMS).

2. **Динамическое планирование**:
    - Решение о порядке выполнения задач принимается во время выполнения.
    - Пример: Earliest Deadline First (EDF).

---

### Алгоритм Rate Monotonic Scheduling (RMS)

**Rate Monotonic Scheduling** (Планирование с монотонными частотами) — это широко используемый статический алгоритм планирования для периодических задач в системах реального времени. RMS является приоритетным алгоритмом, где приоритеты задач фиксируются на основе их периодичности: чем короче период задачи, тем выше её приоритет.

#### Принципы работы RMS:

1. **Фиксированные приоритеты**:

    - Задачи с меньшим периодом (чаще выполняемые) получают более высокий приоритет.
    - Периоды задач известны заранее и не изменяются.

2. **Прерываемость**:

    - Задачи могут быть прерваны задачами с более высоким приоритетом.

3. **Гарантия дедлайнов**:
    - Если задачи удовлетворяют условиям алгоритма RMS, дедлайны будут соблюдены.

#### Условие применимости RMS:

Для выполнения задач в срок общая процессорная нагрузка \( U \) должна быть меньше или равна следующему порогу:
\[
U \leq n \cdot (2^{1/n} - 1)
\]
Где \( n \) — количество задач. Например:

-   Для одной задачи \( U \leq 1 \) (100% процессорного времени).
-   Для двух задач \( U \leq 0.828 \) (~82.8% процессорного времени).
-   Для трёх задач \( U \leq 0.779 \) (~77.9% процессорного времени).

#### Пример RMS:

Предположим, есть три задачи с периодами и временем выполнения:

-   \( T_1 = 4 \), \( C_1 = 1 \) (время выполнения 1 мс каждые 4 мс).
-   \( T_2 = 6 \), \( C_2 = 2 \) (время выполнения 2 мс каждые 6 мс).
-   \( T_3 = 8 \), \( C_3 = 2 \) (время выполнения 2 мс каждые 8 мс).

**Расчёт нагрузки**:
\[
U = \frac{C_1}{T_1} + \frac{C_2}{T_2} + \frac{C_3}{T_3} = \frac{1}{4} + \frac{2}{6} + \frac{2}{8} = 0.25 + 0.333 + 0.25 = 0.833
\]
Для трёх задач \( U \leq 0.779 \). Таким образом, задачи **не могут быть гарантированно выполнены в срок**.

---

### Преимущества и недостатки RMS

#### Преимущества:

1. **Простота реализации**:
    - RMS основывается на фиксированных приоритетах и не требует сложных вычислений.
2. **Временная предсказуемость**:
    - Гарантирует соблюдение дедлайнов при выполнении условий применимости.
3. **Эффективность**:
    - Хорошо работает для периодических задач.

#### Недостатки:

1. **Ограничение на нагрузку**:
    - Максимальная поддерживаемая нагрузка уменьшается с увеличением числа задач.
2. **Неоптимальность для апериодических задач**:
    - RMS не поддерживает задачи с нерегулярными временными требованиями.
3. **Гарантии только при соблюдении условий**:
    - Если процессорная нагрузка превышает порог, дедлайны могут быть нарушены.

---

### Реализация RMS в реальных системах

RMS используется в ОС, которые поддерживают жёсткие системы реального времени, такие как:

1. **RTEMS (Real-Time Executive for Multiprocessor Systems)**:
    - Поддерживает RMS и другие алгоритмы статического планирования.
2. **FreeRTOS**:
    - Позволяет задавать приоритеты вручную, что делает RMS легко реализуемым.
3. **VxWorks**:
    - Распространённая коммерческая ОС реального времени с поддержкой RMS.

---

### Заключение

Планирование в системах реального времени требует строгого соблюдения временных ограничений. Алгоритм RMS предоставляет эффективное и простое решение для периодических задач в жёстких системах реального времени. Однако он имеет ограничения, связанные с максимальной процессорной нагрузкой и отсутствием гибкости для апериодических задач. В реальных системах часто используется сочетание RMS с другими подходами для обеспечения производительности и гибкости.
