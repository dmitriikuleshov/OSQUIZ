### Планирование процессов: введение в системы реального времени

**Планирование процессов** — это механизм операционной системы (ОС), который определяет, какой процесс будет выполнен процессором в следующий момент времени. В системах реального времени (СРВ) планирование процессов приобретает критическое значение, поскольку результат работы системы должен быть получен не только правильно, но и в строго определённое время.

---

### Системы реального времени: определение и типы

**Системы реального времени (СРВ)** — это операционные системы, где выполнение задач связано с временными ограничениями. Такие системы используются там, где важно, чтобы задачи выполнялись в определённые временные интервалы.

#### Типы систем реального времени:

1. **Жёсткие системы реального времени (Hard Real-Time Systems)**:
    - Нарушение временного ограничения недопустимо.
    - Примеры: системы управления полётами, медицинское оборудование, атомные станции.
2. **Мягкие системы реального времени (Soft Real-Time Systems)**:
    - Допустимо нарушение временных ограничений, но это влияет на качество.
    - Примеры: мультимедиа-системы, онлайн-игры.
3. **Фирмовые системы реального времени (Firm Real-Time Systems)**:
    - Нарушение временных ограничений приводит к полной бесполезности результата, но катастрофических последствий нет.
    - Пример: обработка биржевых данных.

---

### Характеристики планирования в системах реального времени

#### Основные характеристики, определяющие планирование в СРВ:

1. **Дедлайны (Deadlines)**:

    - Временные ограничения, до которых задача должна быть завершена.
    - Бывают:
        - Абсолютные: фиксированное время завершения.
        - Относительные: дедлайн задаётся относительно времени начала выполнения.

2. **Периодичность (Periodicity)**:

    - Задачи могут быть:
        - **Периодическими**: выполняются через равные промежутки времени.
          Пример: сбор данных с датчиков каждые 10 мс.
        - **Апериодическими**: выполняются по запросу.
          Пример: обработка прерывания от устройства.

3. **Приоритеты задач**:

    - Задачи могут иметь разные приоритеты, что влияет на порядок их выполнения.
    - Часто задачи с более коротким периодом или ближайшим дедлайном получают более высокий приоритет.

4. **Соблюдение временных ограничений**:

    - ОС должна гарантировать, что задачи будут выполнены в установленные сроки.

5. **Детерминизм**:

    - Поведение системы должно быть предсказуемым, особенно в жёстких СРВ.

6. **Пропускная способность (Utilization)**:
    - Уровень загрузки процессора, при котором система гарантирует выполнение всех задач.

---

### Алгоритм EDF (Earliest Deadline First)

**Earliest Deadline First** (EDF, "Сначала ближайший дедлайн") — это динамический алгоритм планирования, который используется в системах реального времени. EDF считается оптимальным алгоритмом для систем, где требуется обработка задач с дедлайнами.

#### Принципы работы EDF:

1. **Динамическое планирование**:

    - Приоритет задач определяется во время выполнения.
    - Задача с ближайшим дедлайном получает наивысший приоритет.

2. **Прерываемость**:

    - Если появляется задача с более ранним дедлайном, текущая задача приостанавливается.

3. **Гарантия выполнения**:

    - Если суммарная процессорная загрузка \( U \leq 1 \) (100%), то все задачи будут выполнены в срок.

4. **Условие применимости**:
    - EDF гарантирует выполнение дедлайнов только если:
      \[
      U = \sum\_{i=1}^{n} \frac{C_i}{T_i} \leq 1
      \]
    - Где \( C_i \) — время выполнения задачи, \( T_i \) — период задачи.

---

#### Пример работы EDF:

Предположим, есть три задачи:

-   **P1**: \( C_1 = 1 \), \( T_1 = 4 \) (выполняется 1 мс каждые 4 мс).
-   **P2**: \( C_2 = 2 \), \( T_2 = 5 \) (выполняется 2 мс каждые 5 мс).
-   **P3**: \( C_3 = 1 \), \( T_3 = 6 \) (выполняется 1 мс каждые 6 мс).

Суммарная загрузка процессора:
\[
U = \frac{C_1}{T_1} + \frac{C_2}{T_2} + \frac{C_3}{T_3} = \frac{1}{4} + \frac{2}{5} + \frac{1}{6} = 0.25 + 0.4 + 0.1667 = 0.8167
\]
Так как \( U \leq 1 \), все задачи могут быть выполнены.

**Хронология выполнения** (время в мс):

-   \( t = 0 \): выполняется P1, так как её дедлайн раньше (\( 4 \)).
-   \( t = 1 \): выполняется P2 (\( T_2 = 5 \)).
-   \( t = 3 \): продолжается P2.
-   \( t = 4 \): снова выполняется P1.

---

#### Преимущества EDF:

1. **Оптимальность**:
    - EDF гарантирует выполнение всех задач, если \( U \leq 1 \).
2. **Гибкость**:
    - Подходит для смешанных наборов задач (периодических и апериодических).
3. **Эффективность**:
    - Максимально использует процессорное время.

#### Недостатки EDF:

1. **Сложность реализации**:
    - Требуется постоянное обновление приоритетов.
2. **Высокие накладные расходы**:
    - Частое переключение контекста может увеличивать задержки.
3. **Неустойчивость при перегрузке**:
    - Если \( U > 1 \), EDF не может гарантировать выполнение дедлайнов.

---

### Сравнение EDF и других алгоритмов

| Алгоритм | Тип планирования    | Гарантия выполнения           | Особенности                                           |
| -------- | ------------------- | ----------------------------- | ----------------------------------------------------- |
| **EDF**  | Динамическое        | При \( U \leq 1 \)            | Оптимальный для задач с дедлайнами.                   |
| **RMS**  | Статическое         | При \( U \leq n(2^{1/n}-1) \) | Прост в реализации, подходит для периодических задач. |
| **FCFS** | Простой статический | Нет                           | Выполняет задачи в порядке их поступления.            |

---

### Реализация EDF в реальных системах

1. **FreeRTOS**:
    - EDF может быть реализован вручную через настройку приоритетов задач.
2. **VxWorks**:
    - Поддерживает динамическое планирование, включая алгоритмы, схожие с EDF.
3. **RTEMS**:
    - Использует EDF для управления периодическими задачами.

---

### Заключение

EDF — это мощный и оптимальный алгоритм планирования, который обеспечивает выполнение задач с ближайшими дедлайнами. Он особенно эффективен в условиях высокой загрузки процессора (\( U \leq 1 \)) и смешанных рабочих нагрузок. Однако его реализация требует учёта накладных расходов и стабильности в условиях перегрузки. EDF широко используется в системах реального времени, где временная предсказуемость критически важна.
